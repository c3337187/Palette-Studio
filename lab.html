<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Woodmart Studio — подбор цветовой схемы</title>
  <style>
    :root{
      --bg-base:#f6f4fb;
      --bg-card:#ffffff;
      --bg-muted:rgba(255,255,255,0.6);
      --text-strong:#2c2340;
      --text-muted:#6c6384;
      --border-color:rgba(50,36,80,0.12);
      --accent:#805dff;
      --accent-strong:#5c3dff;
      --radius-lg:20px;
      --radius-md:14px;
      --radius-sm:10px;
      --font-sans:"Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
      --font-display:"Manrope", "Inter", system-ui, sans-serif;
    }
    *,*::before,*::after{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,var(--bg-base) 0%,#fff 75%);color:var(--text-strong);font-family:var(--font-sans);line-height:1.6;min-height:100vh}
    a{text-decoration:none;color:inherit}
    .topbar{position:sticky;top:0;z-index:10;background:rgba(255,255,255,0.85);backdrop-filter:blur(14px);border-bottom:1px solid rgba(0,0,0,0.06)}
    .topbar .container{max-width:1280px;margin:0 auto;padding:14px 24px;display:flex;align-items:center;justify-content:space-between}
    .brand{font-weight:700;letter-spacing:0.08em;text-transform:uppercase;font-size:18px;color:color-mix(in srgb,var(--text-strong) 85%, white 15%)}
    .nav-links{display:flex;gap:10px;font-size:14px}
    .nav-link{padding:8px 14px;border-radius:999px;color:var(--text-muted);transition:background .2s,color .2s}
    .nav-link:hover{background:var(--bg-muted);color:var(--text-strong)}
    .nav-link.active{background:var(--accent);color:#fff;box-shadow:0 12px 28px rgba(88,63,200,0.24)}
    main.layout{max-width:1280px;margin:0 auto;padding:42px 24px 80px;display:grid;grid-template-columns:360px 1fr;gap:28px;align-items:start}
    .sidebar{display:flex;flex-direction:column;gap:22px}
    .panel{background:var(--bg-card);border-radius:var(--radius-lg);padding:22px;border:1px solid var(--border-color);box-shadow:0 22px 48px rgba(55,40,100,0.12);display:flex;flex-direction:column;gap:18px}
    .panel h2{margin:0;font-size:20px;font-family:var(--font-display)}
    .panel p{margin:0;color:var(--text-muted);font-size:13px}
    .panel-divider{height:1px;background:rgba(0,0,0,0.08);border:none;margin:2px 0 12px}
    .profile-head{display:flex;flex-direction:column;gap:12px}
    .tab-switch{display:flex;gap:8px}
    .tab-button{padding:8px 12px;border-radius:var(--radius-sm);border:1px solid var(--border-color);background:#fff;color:var(--text-muted);font-size:12px;font-weight:600;letter-spacing:0.05em;text-transform:uppercase;cursor:pointer;transition:all .2s;font-family:var(--font-sans)}
    .tab-button:hover{background:var(--bg-muted);color:var(--text-strong)}
    .tab-button.active{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 12px 26px rgba(88,63,200,0.25)}
    .tab-panel{display:none}
    .tab-panel.active{display:flex;flex-direction:column;gap:18px}
    select, input[type="text"], textarea{width:100%;padding:10px 12px;border-radius:var(--radius-sm);border:1px solid rgba(0,0,0,0.12);background:#fff;color:var(--text-strong);font-family:var(--font-sans);font-size:14px}
    textarea{min-height:160px;resize:vertical;font-family:"JetBrains Mono", "Fira Code", monospace;font-size:13px;line-height:1.6}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:10px 14px;border-radius:var(--radius-sm);border:1px solid var(--border-color);background:#fff;color:var(--text-strong);font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;font-family:var(--font-sans)}
    .btn:hover{background:var(--bg-muted)}
    .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff;box-shadow:0 14px 28px rgba(88,63,200,0.24)}
    .btn.primary:hover{background:var(--accent-strong)}
    .btn.danger{background:color-mix(in srgb,var(--accent) 12%, white 88%);border-color:color-mix(in srgb,var(--accent) 35%, transparent);color:color-mix(in srgb,var(--accent) 70%, var(--text-strong) 30%)}
    .status{font-size:12px;color:var(--text-muted)}
    .preset-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px}
    .preset-card{padding:14px;border-radius:var(--radius-md);border:1px solid rgba(0,0,0,0.08);background:var(--bg-muted);display:flex;flex-direction:column;gap:10px;transition:border .2s,box-shadow .2s}
    .preset-card:hover{border-color:var(--accent);box-shadow:0 12px 28px rgba(88,63,200,0.18)}
    .preset-name{font-size:13px;font-weight:600}
    .preset-desc{font-size:12px;color:var(--text-muted)}
    .preset-tags{display:flex;gap:6px;flex-wrap:wrap}
    .preset-tags span{padding:3px 8px;border-radius:999px;background:#fff;border:1px solid rgba(0,0,0,0.06);font-size:10px;font-weight:600;letter-spacing:0.06em;text-transform:uppercase;color:color-mix(in srgb,var(--text-strong) 70%, white 30%)}
    .preset-swatches{display:flex;gap:6px}
    .preset-swatch{flex:1;height:18px;border-radius:8px;border:1px solid rgba(0,0,0,0.06)}
    .form-section{display:flex;flex-direction:column;gap:16px}
    .section-header{display:flex;flex-direction:column;gap:6px}
    .section-header h3{margin:0;font-size:16px;font-family:var(--font-display)}
    .section-header p{margin:0;font-size:12px;color:var(--text-muted)}
    .field-group{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}
    .field{display:flex;flex-direction:column;gap:8px;padding:14px;border-radius:var(--radius-md);border:1px solid rgba(0,0,0,0.06);background:var(--bg-muted)}
    .field label{font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:0.05em}
    .field small{font-size:12px;color:var(--text-muted)}
    .color-inputs{display:flex;gap:10px;align-items:center}
    .color-inputs input[type="color"]{width:42px;height:42px;border:none;border-radius:var(--radius-sm);padding:0;background:none;cursor:pointer}
    .color-inputs input[type="text"]{flex:1;text-transform:none;font-family:"JetBrains Mono", "Fira Code", monospace;font-size:13px}
    .preview{display:flex;flex-direction:column;gap:24px}
    .preview header h1{margin:0;font-size:26px;font-family:var(--font-display)}
    .preview header p{margin:6px 0 0;font-size:13px;color:var(--text-muted)}
    .preview-card{background:var(--bg-card);border-radius:var(--radius-lg);padding:22px;border:1px solid var(--border-color);box-shadow:0 22px 48px rgba(55,40,100,0.12);display:flex;flex-direction:column;gap:16px}
    .preview-card header{display:flex;justify-content:space-between;align-items:center}
    .preview-card header h3{margin:0;font-size:16px;font-family:var(--font-display)}
    .tag{padding:4px 10px;border-radius:999px;font-size:11px;font-weight:600;letter-spacing:0.06em;text-transform:uppercase;background:var(--bg-muted);color:var(--text-muted)}
    .header-preview,.footer-preview{padding:18px;border-radius:var(--radius-md);color:#fff;display:flex;justify-content:space-between;align-items:center}
    .header-preview nav{display:flex;gap:16px;font-size:13px}
    .hero-preview{border-radius:var(--radius-md);padding:24px;color:#fff;display:flex;flex-direction:column;gap:12px}
    .hero-preview .cta{align-self:flex-start;padding:10px 18px;border-radius:var(--radius-sm);border:none;font-weight:600;cursor:pointer}
    .card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}
    .product-card{border-radius:var(--radius-md);padding:18px;background:var(--bg-muted);display:flex;flex-direction:column;gap:10px}
    .product-card button{margin-top:auto;padding:10px 14px;border-radius:var(--radius-sm);border:none;font-weight:600;cursor:pointer}
    .button-row{display:flex;gap:12px;flex-wrap:wrap}
    .button-row button{padding:10px 16px;border-radius:var(--radius-sm);border:none;font-weight:600;cursor:pointer}
    .link-preview{display:flex;flex-direction:column;gap:6px}
    .link-preview a{font-weight:600}
    .background-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}
    .background-item{padding:14px;border-radius:var(--radius-md);border:1px solid rgba(0,0,0,0.06);display:flex;flex-direction:column;gap:6px;font-size:12px}
    .background-sample{height:40px;border-radius:12px;border:1px solid rgba(0,0,0,0.08)}
    .notice{position:fixed;right:24px;bottom:24px;padding:12px 18px;border-radius:var(--radius-sm);background:var(--accent);color:#fff;font-size:13px;opacity:0;transform:translateY(10px);transition:all .3s}
    .notice.show{opacity:1;transform:translateY(0)}
    @media(max-width:1100px){
      main.layout{grid-template-columns:1fr}
      .preview{order:-1}
    }
    @media(max-width:720px){
      main.layout{padding:32px 16px 72px}
      .panel{padding:18px}
      .field-group{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="container">
      <div class="brand">Palette Studio</div>
      <nav class="nav-links">
        <a class="nav-link" href="index.html">Превью</a>
        <a class="nav-link active" href="lab.html">Woodmart</a>
        <a class="nav-link" href="fonts.html">Документация</a>
      </nav>
    </div>
  </header>

  <main class="layout">
    <aside class="sidebar">
      <section class="panel">
        <div class="profile-head">
          <h2>Профили Woodmart</h2>
          <p>Храните несколько вариантов оформления и переключайтесь между ними.</p>
        </div>
        <div class="tab-switch" role="tablist" data-tab-group="profiles">
          <button class="tab-button active" type="button" data-tab="active" aria-selected="true">Активные</button>
          <button class="tab-button" type="button" data-tab="standard" aria-selected="false">Стандарт</button>
        </div>
        <div class="tab-panel active" data-panel="active">
          <div>
            <label style="font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:0.05em">Активный профиль</label>
            <select id="profileSelect"></select>
          </div>
          <div class="panel-divider" aria-hidden="true"></div>
          <div style="display:flex;flex-wrap:wrap;gap:8px">
            <button class="btn" id="createProfile">Новый профиль</button>
            <button class="btn" id="duplicateProfile">Дублировать</button>
            <button class="btn" id="renameProfile">Переименовать</button>
            <button class="btn danger" id="deleteProfile">Удалить</button>
            <button class="btn" id="resetProfile">Сбросить</button>
          </div>
          <div class="status" id="statusMessage">Готово к редактированию.</div>
        </div>
        <div class="tab-panel" data-panel="standard" hidden>
          <p class="status">10 трендовых сетов 2024 года: примените понравившийся и доработайте детали.</p>
          <div class="preset-grid" id="presetGrid"></div>
        </div>
      </section>

      <section class="panel">
        <div class="form-section" id="formContainer"></div>
      </section>

      <section class="panel">
        <h2>Экспорт и импорт</h2>
        <p>Готовый JSON можно вставить в проект или отправить ИИ для генерации вариаций.</p>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn primary" id="copyJson">Скопировать JSON</button>
          <button class="btn" id="downloadJson">Скачать</button>
          <button class="btn" id="importJson">Импорт JSON</button>
          <button class="btn" id="pasteJson">Вставить из буфера</button>
        </div>
        <textarea id="exportArea" readonly></textarea>
      </section>
    </aside>

    <section class="preview">
      <header>
        <div>
          <h1>Превью профиля</h1>
          <p>Секции ниже собраны по структуре Woodmart: шапка, карточки, кнопки, ссылки и фоны страниц.</p>
        </div>
      </header>

      <div class="preview-card">
        <header>
          <h3>Шапка и футер</h3>
          <span class="tag">Layout</span>
        </header>
        <div class="header-preview" id="headerPreview">
          <div>Woodmart</div>
          <nav><span>Каталог</span><span>Коллекции</span><span>Контакты</span></nav>
        </div>
        <div class="footer-preview" id="footerPreview">
          <span>© 2024. Все права защищены.</span>
          <span>+7 (900) 000-00-00</span>
        </div>
      </div>

      <div class="preview-card">
        <header>
          <h3>Hero и карточки</h3>
          <span class="tag">Content</span>
        </header>
        <div class="hero-preview" id="heroPreview">
          <span style="font-size:13px;letter-spacing:0.08em;text-transform:uppercase;opacity:0.75">Новая коллекция</span>
          <div id="heroTitle" style="font-size:28px;font-weight:700;line-height:1.2">Заголовок витрины</div>
          <p id="heroText" style="margin:0;font-size:14px;max-width:420px">Описание адаптируется под базовую типографику. Проверьте читаемость на выбранном фоне.</p>
          <button class="cta" id="heroButton">Подробнее</button>
        </div>
        <div class="card-grid">
          <article class="product-card">
            <div style="font-weight:600" id="cardTitle">Льняной плед</div>
            <p id="cardText" style="margin:0;font-size:14px">Базовый текст карточки товара или поста.</p>
            <button id="cardButton">В корзину</button>
          </article>
          <article class="product-card">
            <div style="font-weight:600" id="cardTitleAlt">Настольная лампа</div>
            <p id="cardTextAlt" style="margin:0;font-size:14px">Пример вторичного описания.</p>
            <button id="cardButtonAlt">Купить</button>
          </article>
        </div>
      </div>

      <div class="preview-card">
        <header>
          <h3>Кнопки и ссылки</h3>
          <span class="tag">UI</span>
        </header>
        <div class="button-row">
          <button id="defaultButton">Default button</button>
          <button id="defaultButtonHover">Default hover</button>
          <button id="accentButton">Accent button</button>
          <button id="accentButtonHover">Accent hover</button>
        </div>
        <div class="link-preview">
          <span>Links preview:</span>
          <div>
            <a href="#" id="linkRegular">Ссылка в тексте</a>
            <span> · </span>
            <a href="#" id="linkHover">Наведение</a>
          </div>
          <div style="font-size:12px" id="underlineInfo"></div>
        </div>
      </div>

      <div class="preview-card">
        <header>
          <h3>Фоны страниц</h3>
          <span class="tag">Background</span>
        </header>
        <div class="background-grid" id="backgroundGrid"></div>
      </div>
    </section>
  </main>

  <div class="notice" id="notice"></div>
  <input type="file" id="importInput" accept="application/json" hidden />

  <script src="palette-store.js"></script>
  <script>
    const store = WoodmartStore;
    let state = store.loadState();
    let activeProfile = store.getActiveProfile(state);

    const profileSelect = document.getElementById('profileSelect');
    const statusMessage = document.getElementById('statusMessage');
    const presetGrid = document.getElementById('presetGrid');
    const formContainer = document.getElementById('formContainer');
    const exportArea = document.getElementById('exportArea');
    const importInput = document.getElementById('importInput');
    const notice = document.getElementById('notice');

    const headerPreview = document.getElementById('headerPreview');
    const footerPreview = document.getElementById('footerPreview');
    const heroPreview = document.getElementById('heroPreview');
    const heroTitle = document.getElementById('heroTitle');
    const heroText = document.getElementById('heroText');
    const heroButton = document.getElementById('heroButton');
    const cardTitle = document.getElementById('cardTitle');
    const cardText = document.getElementById('cardText');
    const cardButton = document.getElementById('cardButton');
    const cardTitleAlt = document.getElementById('cardTitleAlt');
    const cardTextAlt = document.getElementById('cardTextAlt');
    const cardButtonAlt = document.getElementById('cardButtonAlt');
    const defaultButton = document.getElementById('defaultButton');
    const defaultButtonHover = document.getElementById('defaultButtonHover');
    const accentButton = document.getElementById('accentButton');
    const accentButtonHover = document.getElementById('accentButtonHover');
    const linkRegular = document.getElementById('linkRegular');
    const linkHover = document.getElementById('linkHover');
    const underlineInfo = document.getElementById('underlineInfo');
    const backgroundGrid = document.getElementById('backgroundGrid');

    const tabs = document.querySelectorAll('.tab-button');
    const panels = document.querySelectorAll('.tab-panel');

    tabs.forEach(button => {
      button.addEventListener('click', () => {
        const tab = button.dataset.tab;
        tabs.forEach(btn => btn.classList.toggle('active', btn === button));
        panels.forEach(panel => {
          const isActive = panel.dataset.panel === tab;
          panel.classList.toggle('active', isActive);
          panel.hidden = !isActive;
        });
      });
    });

    const FIELD_SCHEMA = [
      {
        title:'Header',
        description:'Цветовая основа шапки сайта Woodmart. Работает в связке с типографикой хедера.',
        fields:[
          {
            type:'color',
            label:'Цвет шапки',
            path:'header.color',
            placeholder:'rgb(129, 119, 142)',
            note:'Используется для фонового слоя меню и sticky-header. Поддерживайте достаточный контраст с элементами навигации.'
          }
        ]
      },
      {
        title:'Footer',
        description:'Фон и основа нижнего блока.',
        fields:[
          {
            type:'color',
            label:'Цвет футера',
            path:'footer.color',
            placeholder:'rgb(129, 119, 142)',
            note:'Фон подвалов, платежных блоков и контактной информации.'
          }
        ]
      },
      {
        title:'Typography — Basic',
        description:'Базовая гарнитура для тела текста. Применяется ко всем зонам, где не задано иное.',
        fields:[
          {type:'text', label:'Название шрифта', path:'typography.basic.fontFamily', placeholder:'Lora', note:'Пример: Lora. Будет использоваться как семейство по умолчанию.'},
          {type:'text', label:'Style', path:'typography.basic.style', placeholder:'Medium 500'},
          {type:'text', label:'Тип (subset)', path:'typography.basic.type', placeholder:'Cyrillic'},
          {type:'text', label:'Font size', path:'typography.basic.fontSize', placeholder:'16px'},
          {type:'color', label:'Цвет текста', path:'typography.basic.color', placeholder:'rgb(34, 34, 34)', note:'Цвет основного текста и описаний.'}
        ]
      },
      {
        title:'Typography — Titles',
        description:'Заголовки h1–h6: брендовые, выразительные, но читаемые.',
        fields:[
          {type:'text', label:'Название шрифта', path:'typography.title.fontFamily', placeholder:'Lora'},
          {type:'text', label:'Style', path:'typography.title.style', placeholder:'Medium 500'},
          {type:'text', label:'Тип', path:'typography.title.type', placeholder:'Cyrillic'},
          {type:'text', label:'Text transform', path:'typography.title.textTransform', placeholder:'Uppercase', note:'Необязательно: Uppercase, Capitalize и т.д.'},
          {type:'color', label:'Цвет заголовков', path:'typography.title.color', placeholder:'rgb(129, 119, 142)', note:'Используется для всех уровней заголовков.'}
        ]
      },
      {
        title:'Typography — Entities names',
        description:'Названия товаров, статей, проектов. Поддерживает состояние наведения.',
        fields:[
          {type:'text', label:'Название шрифта', path:'typography.entities.fontFamily', placeholder:'Lora'},
          {type:'text', label:'Style', path:'typography.entities.style', placeholder:'Medium 500'},
          {type:'text', label:'Тип', path:'typography.entities.type', placeholder:'Cyrillic'},
          {type:'text', label:'Text transform', path:'typography.entities.textTransform', placeholder:'Uppercase', note:'Необязательно. Например, Uppercase.'},
          {type:'color', label:'Цвет', path:'typography.entities.color', placeholder:'rgb(129, 119, 142)'},
          {type:'color', label:'Цвет при наведении', path:'typography.entities.hoverColor', placeholder:'rgb(129, 119, 142)'}
        ]
      },
      {
        title:'Typography — Secondary',
        description:'Альтернативная гарнитура для блоков с классом font-alt и виджетов конструктора.',
        fields:[
          {type:'text', label:'Название шрифта', path:'typography.secondary.fontFamily', placeholder:'Lora'},
          {type:'text', label:'Style', path:'typography.secondary.style', placeholder:'Normal 400'},
          {type:'text', label:'Тип', path:'typography.secondary.type', placeholder:'Cyrillic'}
        ]
      },
      {
        title:'Typography — Widget titles',
        description:'Заголовки виджетов и сайдбаров.',
        fields:[
          {type:'text', label:'Название шрифта', path:'typography.widget.fontFamily', placeholder:'Lora'},
          {type:'text', label:'Style', path:'typography.widget.style', placeholder:'Medium 500'},
          {type:'text', label:'Тип', path:'typography.widget.type', placeholder:'Cyrillic'},
          {type:'text', label:'Text transform', path:'typography.widget.textTransform', placeholder:'Uppercase'},
          {type:'text', label:'Font size', path:'typography.widget.fontSize', placeholder:'16px'},
          {type:'color', label:'Цвет', path:'typography.widget.color', placeholder:'rgb(129, 119, 142)'}
        ]
      },
      {
        title:'Typography — Header font',
        description:'Шрифтовая пара для элементов шапки: меню, иконки, кнопки.',
        fields:[
          {type:'text', label:'Название шрифта', path:'typography.header.fontFamily', placeholder:'Lora'},
          {type:'text', label:'Style', path:'typography.header.style', placeholder:'Medium 500'},
          {type:'text', label:'Тип', path:'typography.header.type', placeholder:'Cyrillic'},
          {type:'text', label:'Text transform', path:'typography.header.textTransform', placeholder:'Uppercase'},
          {type:'text', label:'Font size', path:'typography.header.fontSize', placeholder:'16px'}
        ]
      },
      {
        title:'Colors',
        description:'Базовые фирменные цвета темы: кнопки и выделения.',
        fields:[
          {type:'color', label:'Primary color', path:'colors.primary', placeholder:'rgb(192, 103, 255)', note:'Используется для кнопок и основных акцентов.'},
          {type:'color', label:'Secondary color', path:'colors.secondary', placeholder:'rgb(192, 103, 255)', note:'Опции page builder с выбором Secondary.'}
        ]
      },
      {
        title:'Pages background',
        description:'Фоновые слои для страниц, магазинов и блогов.',
        fields:[
          {type:'color', label:'All pages background', path:'backgrounds.pages.all', placeholder:'rgb(192, 103, 255)'},
          {type:'color', label:'Product archive background', path:'backgrounds.shop.archive', placeholder:'rgb(192, 103, 255)'},
          {type:'color', label:'Single product background', path:'backgrounds.shop.single', placeholder:'rgb(192, 103, 255)', note:'Можно переопределить для отдельных товаров.'},
          {type:'color', label:'Blog archive background', path:'backgrounds.blog.archive', placeholder:'rgb(192, 103, 255)'},
          {type:'color', label:'Single post background', path:'backgrounds.blog.single', placeholder:'rgb(192, 103, 255)'}
        ]
      },
      {
        title:'Buttons — Default',
        description:'Основные кнопки Woodmart.',
        fields:[
          {type:'text', label:'Название шрифта', path:'buttons.default.fontFamily', placeholder:'Lora'},
          {type:'text', label:'Style', path:'buttons.default.style', placeholder:'Medium 500'},
          {type:'text', label:'Text transform', path:'buttons.default.textTransform', placeholder:'Uppercase'},
          {type:'color', label:'Фон кнопки', path:'buttons.default.background', placeholder:'rgb(129, 119, 142)'},
          {type:'color', label:'Hover фон', path:'buttons.default.hoverBackground', placeholder:'rgb(129, 119, 142)'}
        ]
      },
      {
        title:'Buttons — Accent',
        description:'Второй стиль CTA для специальных блоков.',
        fields:[
          {type:'text', label:'Название шрифта', path:'buttons.accent.fontFamily', placeholder:'Lora'},
          {type:'text', label:'Style', path:'buttons.accent.style', placeholder:'Medium 500'},
          {type:'text', label:'Text transform', path:'buttons.accent.textTransform', placeholder:'Uppercase'},
          {type:'color', label:'Фон кнопки', path:'buttons.accent.background', placeholder:'rgb(129, 119, 142)'},
          {type:'color', label:'Hover фон', path:'buttons.accent.hoverBackground', placeholder:'rgb(129, 119, 142)'}
        ]
      },
      {
        title:'Links',
        description:'Параметры ссылок в тексте и карточках.',
        fields:[
          {type:'color', label:'Цвет — обычное состояние', path:'links.color.regular', placeholder:'rgb(129, 119, 142)'},
          {type:'color', label:'Цвет — наведение', path:'links.color.hover', placeholder:'rgb(129, 119, 142)'},
          {type:'text', label:'Underline — regular', path:'links.underline.regular', placeholder:'Solid'},
          {type:'text', label:'Underline — hover', path:'links.underline.hover', placeholder:'Solid'},
          {type:'color', label:'Underline color — regular', path:'links.underlineColor.regular', placeholder:'rgb(129, 119, 142)'},
          {type:'color', label:'Underline color — hover', path:'links.underlineColor.hover', placeholder:'rgb(129, 119, 142)'}
        ]
      }
    ];

    const fieldRegistry = new Map();

    function buildForm(){
      formContainer.innerHTML = '';
      FIELD_SCHEMA.forEach(section => {
        const sectionEl = document.createElement('section');
        sectionEl.className = 'form-section';
        const header = document.createElement('div');
        header.className = 'section-header';
        const title = document.createElement('h3');
        title.textContent = section.title;
        header.appendChild(title);
        if(section.description){
          const desc = document.createElement('p');
          desc.textContent = section.description;
          header.appendChild(desc);
        }
        sectionEl.appendChild(header);
        const group = document.createElement('div');
        group.className = 'field-group';
        section.fields.forEach(field => {
          const fieldEl = document.createElement('div');
          fieldEl.className = 'field';
          const label = document.createElement('label');
          label.textContent = field.label;
          fieldEl.appendChild(label);
          if(field.type === 'color'){
            const wrap = document.createElement('div');
            wrap.className = 'color-inputs';
            const colorInput = document.createElement('input');
            colorInput.type = 'color';
            const textInput = document.createElement('input');
            textInput.type = 'text';
            textInput.placeholder = field.placeholder || '';
            wrap.appendChild(colorInput);
            wrap.appendChild(textInput);
            fieldEl.appendChild(wrap);
            if(field.note){
              const note = document.createElement('small');
              note.textContent = field.note;
              fieldEl.appendChild(note);
            }
            const handlers = {
              set value(val){
                textInput.value = val || '';
                colorInput.value = store.readColorAsHex(val || '');
              }
            };
            colorInput.addEventListener('input', () => {
              const rgb = store.colorToRgbString(colorInput.value);
              textInput.value = rgb;
              updateField(field.path, rgb, field.label);
            });
            textInput.addEventListener('change', () => {
              updateField(field.path, textInput.value.trim(), field.label);
              colorInput.value = store.readColorAsHex(textInput.value.trim());
            });
            fieldRegistry.set(field.path, {type:'color', textInput, colorInput, handlers});
          }else{
            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = field.placeholder || '';
            fieldEl.appendChild(input);
            if(field.note){
              const note = document.createElement('small');
              note.textContent = field.note;
              fieldEl.appendChild(note);
            }
            input.addEventListener('change', () => updateField(field.path, input.value.trim(), field.label));
            fieldRegistry.set(field.path, {type:'text', input});
          }
          group.appendChild(fieldEl);
        });
        sectionEl.appendChild(group);
        formContainer.appendChild(sectionEl);
      });
    }

    function renderPresets(){
      const presets = store.getStandardPresets();
      presetGrid.innerHTML = '';
      presets.forEach(preset => {
        const card = document.createElement('article');
        card.className = 'preset-card';
        const name = document.createElement('div');
        name.className = 'preset-name';
        name.textContent = preset.name;
        card.appendChild(name);
        const swatches = document.createElement('div');
        swatches.className = 'preset-swatches';
        const swatchPrimary = document.createElement('div');
        swatchPrimary.className = 'preset-swatch';
        swatchPrimary.style.background = preset.config.colors.primary;
        const swatchSecondary = document.createElement('div');
        swatchSecondary.className = 'preset-swatch';
        swatchSecondary.style.background = preset.config.colors.secondary;
        const swatchHeader = document.createElement('div');
        swatchHeader.className = 'preset-swatch';
        swatchHeader.style.background = preset.config.header.color;
        swatches.appendChild(swatchPrimary);
        swatches.appendChild(swatchSecondary);
        swatches.appendChild(swatchHeader);
        card.appendChild(swatches);
        const desc = document.createElement('div');
        desc.className = 'preset-desc';
        desc.textContent = preset.description;
        card.appendChild(desc);
        const tags = document.createElement('div');
        tags.className = 'preset-tags';
        preset.tags.forEach(tag => {
          const chip = document.createElement('span');
          chip.textContent = tag;
          tags.appendChild(chip);
        });
        card.appendChild(tags);
        const button = document.createElement('button');
        button.className = 'btn primary';
        button.textContent = 'Применить';
        button.addEventListener('click', () => {
          const newProfile = store.createProfileFromPreset(preset);
          newProfile.name += ' (пресет)';
          state.profiles.push(newProfile);
          state.activeId = newProfile.id;
          store.saveState(state);
          activeProfile = store.getActiveProfile(state);
          refreshAll('Добавлен новый профиль из пресета.');
        });
        card.appendChild(button);
        presetGrid.appendChild(card);
      });
    }

    function renderProfileSelect(){
      profileSelect.innerHTML = '';
      state.profiles.forEach(profile => {
        const option = document.createElement('option');
        option.value = profile.id;
        option.textContent = profile.name;
        if(profile.id === state.activeId){
          option.selected = true;
        }
        profileSelect.appendChild(option);
      });
    }

    function syncFields(){
      fieldRegistry.forEach((entry, path) => {
        const value = store.getByPath(activeProfile.config, path) || '';
        if(entry.type === 'color'){
          entry.handlers.value = value;
        }else if(entry.type === 'text'){
          entry.input.value = value;
        }
      });
      exportArea.value = store.exportProfile(activeProfile);
    }

    function updateField(path, value, label){
      state = store.updateProfile(state, activeProfile.id, config => {
        store.setByPath(config, path, value);
        return config;
      });
      activeProfile = store.getActiveProfile(state);
      syncFields();
      renderPreview();
      statusMessage.textContent = label ? `${label}: обновлено.` : 'Изменения сохранены.';
    }

    profileSelect.addEventListener('change', () => {
      state = store.setActive(state, profileSelect.value);
      activeProfile = store.getActiveProfile(state);
      syncFields();
      renderPreview();
      statusMessage.textContent = 'Профиль переключён.';
    });

    document.getElementById('createProfile').addEventListener('click', () => {
      const fresh = store.createProfile('Новый профиль', store.DEFAULT_CONFIG);
      state.profiles.push(fresh);
      state.activeId = fresh.id;
      store.saveState(state);
      activeProfile = store.getActiveProfile(state);
      refreshAll('Создан новый профиль.');
    });

    document.getElementById('duplicateProfile').addEventListener('click', () => {
      state = store.duplicateProfile(state, activeProfile.id);
      activeProfile = store.getActiveProfile(state);
      refreshAll('Профиль продублирован.');
    });

    document.getElementById('renameProfile').addEventListener('click', () => {
      const newName = prompt('Новое имя профиля', activeProfile.name);
      if(newName){
        state = store.renameProfile(state, activeProfile.id, newName.trim());
        activeProfile = store.getActiveProfile(state);
        refreshAll('Профиль переименован.');
      }
    });

    document.getElementById('deleteProfile').addEventListener('click', () => {
      if(state.profiles.length === 1){
        showNotice('Невозможно удалить единственный профиль.');
        return;
      }
      if(confirm('Удалить активный профиль?')){
        state = store.deleteProfile(state, activeProfile.id);
        activeProfile = store.getActiveProfile(state);
        refreshAll('Профиль удалён.');
      }
    });

    document.getElementById('resetProfile').addEventListener('click', () => {
      if(confirm('Сбросить профиль к стандартным значениям?')){
        state = store.resetProfile(state, activeProfile.id);
        activeProfile = store.getActiveProfile(state);
        refreshAll('Профиль сброшен.');
      }
    });

    document.getElementById('copyJson').addEventListener('click', () => {
      navigator.clipboard.writeText(exportArea.value).then(() => {
        showNotice('JSON скопирован в буфер обмена.');
      }).catch(() => showNotice('Не удалось скопировать JSON.'));
    });

    document.getElementById('downloadJson').addEventListener('click', () => {
      const blob = new Blob([exportArea.value], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `${activeProfile.name.replace(/\s+/g,'-').toLowerCase()}-woodmart.json`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
      showNotice('JSON выгружен.');
    });

    document.getElementById('importJson').addEventListener('click', () => importInput.click());

    importInput.addEventListener('change', (event) => {
      const file = event.target.files && event.target.files[0];
      if(!file){
        return;
      }
      const reader = new FileReader();
      reader.onload = () => {
        try{
          const payload = JSON.parse(reader.result);
          const imported = store.importProfile(payload);
          state.profiles.push(imported);
          state.activeId = imported.id;
          store.saveState(state);
          activeProfile = store.getActiveProfile(state);
          refreshAll('Профиль импортирован.');
        }catch(err){
          console.error(err);
          showNotice('Ошибка импорта: ' + err.message);
        }
      };
      reader.readAsText(file);
      importInput.value = '';
    });

    document.getElementById('pasteJson').addEventListener('click', async () => {
      try{
        const text = await navigator.clipboard.readText();
        const payload = JSON.parse(text);
        const imported = store.importProfile(payload);
        state.profiles.push(imported);
        state.activeId = imported.id;
        store.saveState(state);
        activeProfile = store.getActiveProfile(state);
        refreshAll('Профиль вставлен из буфера.');
      }catch(err){
        console.error(err);
        showNotice('Ошибка вставки: ' + err.message);
      }
    });

    function renderPreview(){
      const cfg = activeProfile.config;
      headerPreview.style.background = cfg.header.color;
      headerPreview.style.fontFamily = `'${cfg.typography.header.fontFamily || cfg.typography.basic.fontFamily}', var(--font-sans)`;
      headerPreview.style.fontSize = cfg.typography.header.fontSize || '14px';
      headerPreview.style.textTransform = (cfg.typography.header.textTransform || 'none').toLowerCase();
      footerPreview.style.background = cfg.footer.color;
      footerPreview.style.fontFamily = `'${cfg.typography.basic.fontFamily}', var(--font-sans)`;
      footerPreview.style.color = cfg.typography.basic.color;

      heroPreview.style.background = `linear-gradient(135deg, ${cfg.colors.secondary}, ${cfg.colors.primary})`;
      heroTitle.style.fontFamily = `'${cfg.typography.title.fontFamily}', var(--font-sans)`;
      heroTitle.style.textTransform = (cfg.typography.title.textTransform || 'none').toLowerCase();
      heroTitle.style.color = cfg.typography.title.color;
      heroText.style.fontFamily = `'${cfg.typography.basic.fontFamily}', var(--font-sans)`;
      heroText.style.color = cfg.typography.basic.color;
      heroText.style.fontSize = cfg.typography.basic.fontSize || '16px';
      heroButton.style.fontFamily = `'${cfg.buttons.default.fontFamily}', var(--font-sans)`;
      heroButton.style.background = cfg.buttons.default.background;
      heroButton.style.color = '#fff';
      heroButton.style.textTransform = (cfg.buttons.default.textTransform || 'none').toLowerCase();

      cardTitle.style.fontFamily = `'${cfg.typography.entities.fontFamily}', var(--font-sans)`;
      cardTitle.style.textTransform = (cfg.typography.entities.textTransform || 'none').toLowerCase();
      cardTitle.style.color = cfg.typography.entities.color;
      cardText.style.fontFamily = `'${cfg.typography.basic.fontFamily}', var(--font-sans)`;
      cardText.style.color = cfg.typography.basic.color;
      cardText.style.fontSize = cfg.typography.basic.fontSize || '16px';
      cardButton.style.background = cfg.buttons.default.background;
      cardButton.style.color = '#fff';
      cardButton.style.fontFamily = `'${cfg.buttons.default.fontFamily}', var(--font-sans)`;
      cardButton.style.textTransform = (cfg.buttons.default.textTransform || 'none').toLowerCase();

      cardTitleAlt.style.fontFamily = `'${cfg.typography.entities.fontFamily}', var(--font-sans)`;
      cardTitleAlt.style.color = cfg.typography.entities.color;
      cardTextAlt.style.fontFamily = `'${cfg.typography.secondary.fontFamily || cfg.typography.basic.fontFamily}', var(--font-sans)`;
      cardTextAlt.style.color = cfg.typography.basic.color;
      cardButtonAlt.style.background = cfg.buttons.accent.background;
      cardButtonAlt.style.color = '#fff';
      cardButtonAlt.style.fontFamily = `'${cfg.buttons.accent.fontFamily}', var(--font-sans)`;
      cardButtonAlt.style.textTransform = (cfg.buttons.accent.textTransform || 'none').toLowerCase();

      defaultButton.style.background = cfg.buttons.default.background;
      defaultButton.style.fontFamily = `'${cfg.buttons.default.fontFamily}', var(--font-sans)`;
      defaultButton.style.color = '#fff';
      defaultButton.style.textTransform = (cfg.buttons.default.textTransform || 'none').toLowerCase();

      defaultButtonHover.style.background = cfg.buttons.default.hoverBackground;
      defaultButtonHover.style.fontFamily = `'${cfg.buttons.default.fontFamily}', var(--font-sans)`;
      defaultButtonHover.style.color = '#fff';
      defaultButtonHover.style.textTransform = (cfg.buttons.default.textTransform || 'none').toLowerCase();

      accentButton.style.background = cfg.buttons.accent.background;
      accentButton.style.fontFamily = `'${cfg.buttons.accent.fontFamily}', var(--font-sans)`;
      accentButton.style.color = '#fff';
      accentButton.style.textTransform = (cfg.buttons.accent.textTransform || 'none').toLowerCase();

      accentButtonHover.style.background = cfg.buttons.accent.hoverBackground;
      accentButtonHover.style.fontFamily = `'${cfg.buttons.accent.fontFamily}', var(--font-sans)`;
      accentButtonHover.style.color = '#fff';
      accentButtonHover.style.textTransform = (cfg.buttons.accent.textTransform || 'none').toLowerCase();

      linkRegular.style.color = cfg.links.color.regular;
      linkRegular.style.textDecorationStyle = cfg.links.underline.regular || 'solid';
      linkRegular.style.textDecorationColor = cfg.links.underlineColor.regular || cfg.links.color.regular;
      linkRegular.style.textDecorationLine = 'underline';

      linkHover.style.color = cfg.links.color.hover;
      linkHover.style.textDecorationStyle = cfg.links.underline.hover || 'solid';
      linkHover.style.textDecorationColor = cfg.links.underlineColor.hover || cfg.links.color.hover;
      linkHover.style.textDecorationLine = 'underline';

      underlineInfo.textContent = `Underline: regular — ${cfg.links.underline.regular || 'none'}, hover — ${cfg.links.underline.hover || 'none'}`;

      backgroundGrid.innerHTML = '';
      const backgrounds = [
        {label:'All pages', value:cfg.backgrounds.pages.all},
        {label:'Shop archive', value:cfg.backgrounds.shop.archive},
        {label:'Single product', value:cfg.backgrounds.shop.single},
        {label:'Blog archive', value:cfg.backgrounds.blog.archive},
        {label:'Single post', value:cfg.backgrounds.blog.single}
      ];
      backgrounds.forEach(item => {
        const card = document.createElement('div');
        card.className = 'background-item';
        const sample = document.createElement('div');
        sample.className = 'background-sample';
        sample.style.background = item.value;
        card.appendChild(sample);
        const label = document.createElement('div');
        label.textContent = item.label;
        card.appendChild(label);
        const code = document.createElement('code');
        code.textContent = item.value;
        card.appendChild(code);
        backgroundGrid.appendChild(card);
      });
    }

    function refreshAll(message){
      renderProfileSelect();
      syncFields();
      renderPreview();
      if(message){
        statusMessage.textContent = message;
        showNotice(message);
      }
    }

    function showNotice(text){
      notice.textContent = text;
      notice.classList.add('show');
      setTimeout(() => notice.classList.remove('show'), 2800);
    }

    buildForm();
    renderPresets();
    renderProfileSelect();
    syncFields();
    renderPreview();
  </script>
</body>
</html>
