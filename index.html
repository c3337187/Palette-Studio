<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Цветовая палитра — стенд</title>
  <style>
    :root{
      --color-base:#F5F3FA;
      --color-secondary:#D6CFFE;
      --color-accent:#FFB870;
      --color-neutral:#2F2537;
      --surface-primary:var(--color-base);
      --surface-card:color-mix(in srgb,var(--color-base) 85%, white 15%);
      --surface-muted:color-mix(in srgb,var(--color-secondary) 35%, white);
      --surface-hero:color-mix(in srgb,var(--color-secondary) 60%, var(--color-accent));
      --surface-accent:color-mix(in srgb,var(--color-secondary) 70%, var(--color-neutral));
      --text-strong:var(--color-neutral);
      --text-muted:color-mix(in srgb,var(--color-neutral) 58%, var(--surface-primary) 42%);
      --border-subtle:color-mix(in srgb,var(--color-secondary) 24%, var(--color-neutral));
      --action-primary:color-mix(in srgb,var(--color-accent) 82%, var(--color-neutral));
      --action-primary-hover:color-mix(in srgb,var(--color-accent) 92%, white 8%);
      --badge-accent:color-mix(in srgb,var(--color-secondary) 55%, white);
      --ratio-primary:var(--surface-primary);
      --ratio-secondary:var(--surface-muted);
      --ratio-accent:var(--action-primary);
      --font-heading:'Manrope', 'Inter', 'Segoe UI', system-ui, sans-serif;
      --font-body:'Inter', 'Segoe UI', system-ui, sans-serif;
      --font-ui:'Manrope', 'Inter', 'Segoe UI', system-ui, sans-serif;
    }
    *,*::before,*::after{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,var(--surface-primary),#fff 70%);color:var(--text-strong);font-family:var(--font-body);line-height:1.6;min-height:100vh;display:flex;flex-direction:column}
    a{text-decoration:none;color:inherit}
    .topbar{background:rgba(255,255,255,0.82);backdrop-filter:blur(14px);border-bottom:1px solid rgba(0,0,0,0.06);position:sticky;top:0;z-index:10}
    .topbar .container{max-width:1200px;margin:0 auto;padding:14px 24px;display:flex;align-items:center;justify-content:space-between;gap:20px}
    .brand{font-weight:700;font-size:18px;letter-spacing:0.06em;text-transform:uppercase;color:color-mix(in srgb,var(--color-neutral) 85%, white 15%)}
    .nav-links{display:flex;gap:12px;font-size:14px}
    .nav-link{padding:8px 14px;border-radius:999px;color:var(--text-muted);transition:background .2s,color .2s}
    .nav-link:hover{background:var(--surface-muted);color:var(--text-strong)}
    .nav-link.active{background:var(--action-primary);color:#fff;box-shadow:0 10px 24px rgba(76,45,110,0.18)}
    main{flex:1}
    .wrapper{max-width:1200px;margin:0 auto;padding:48px 24px 72px;display:flex;flex-direction:column;gap:56px}
    .hero{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:32px;align-items:center;background:var(--surface-card);padding:32px;border-radius:22px;box-shadow:0 20px 55px rgba(54,38,70,0.14);border:1px solid rgba(54,38,70,0.08)}
    .hero h1{margin:0;font-family:var(--font-heading);font-size:34px;line-height:1.2}
    .hero p{margin:12px 0 0;color:var(--text-muted)}
    .hero .cta{display:flex;gap:12px;flex-wrap:wrap;margin-top:26px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 20px;border-radius:14px;font-weight:600;font-size:14px;text-decoration:none;cursor:pointer;transition:background .2s,color .2s,box-shadow .2s;font-family:var(--font-ui)}
    .btn-primary{background:var(--action-primary);color:#fff;box-shadow:0 14px 32px rgba(76,45,110,0.24)}
    .btn-primary:hover{background:var(--action-primary-hover)}
    .btn-secondary{background:var(--surface-card);color:var(--text-strong);border:1px solid var(--border-subtle)}
    .btn-secondary:hover{box-shadow:0 10px 26px rgba(0,0,0,0.1)}
    section h2{margin:0 0 18px;font-size:24px;font-family:var(--font-heading)}
    .palette-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px}
    .token-card{background:var(--surface-card);border-radius:18px;padding:20px;border:1px solid rgba(54,38,70,0.08);box-shadow:0 10px 30px rgba(54,38,70,0.08);display:flex;flex-direction:column;gap:12px}
    .token-card .swatch{height:88px;border-radius:12px;box-shadow:inset 0 -6px 18px rgba(0,0,0,0.05)}
    .token-card .meta{display:flex;justify-content:space-between;align-items:center;font-size:13px;color:var(--text-muted)}
    .token-card .meta .var{font-family:monospace;color:color-mix(in srgb,var(--color-secondary) 55%, var(--color-neutral) 45%);font-size:11px;margin-left:6px}
    .token-card .hex{font-family:monospace;font-weight:700}
    .token-card .desc{font-size:13px;color:var(--text-muted);line-height:1.5}
    .token-card .usage{display:flex;gap:8px;flex-wrap:wrap;font-size:12px}
    .token-card .usage span{padding:6px 10px;border-radius:999px;background:var(--surface-muted);border:1px solid rgba(0,0,0,0.05);color:color-mix(in srgb,var(--color-neutral) 82%, white 18%)}
    .component-section{display:flex;flex-direction:column;gap:32px}
    .component-card{background:var(--surface-card);padding:24px;border-radius:20px;border:1px solid rgba(54,38,70,0.08);box-shadow:0 12px 34px rgba(54,38,70,0.1);display:flex;flex-direction:column;gap:18px}
    .component-card header{display:flex;justify-content:space-between;align-items:center}
    .component-card header h3{margin:0;font-size:18px;font-family:var(--font-heading)}
    .tag{padding:4px 10px;border-radius:999px;font-size:11px;background:var(--badge-accent);color:var(--text-strong);font-weight:600;border:1px solid rgba(0,0,0,0.05);text-transform:uppercase;letter-spacing:0.06em}
    .component-row{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:24px}
    .component-row .component-card{height:100%}
    .nav-demo{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;border-radius:14px;background:var(--surface-muted);border:1px solid var(--border-subtle)}
    .nav-demo .links{display:flex;gap:14px;font-size:14px;color:var(--text-muted)}
    .button-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:12px}
    .button-item{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 14px;border-radius:14px;background:var(--surface-muted);border:1px solid rgba(0,0,0,0.04)}
    .button-item span{font-size:12px;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.05em}
    .btn-demo{padding:10px 18px;border-radius:12px;border:none;background:var(--action-primary);color:#fff;font-weight:600;font-family:var(--font-ui);box-shadow:0 8px 22px rgba(0,0,0,0.12);cursor:pointer;transition:background .2s,box-shadow .2s}
    .btn-demo:hover:not([disabled]){background:var(--action-primary-hover);box-shadow:0 10px 26px rgba(0,0,0,0.16)}
    .btn-demo[data-state="hover"]{background:var(--action-primary-hover)}
    .btn-demo[data-state="disabled"]{background:color-mix(in srgb,var(--action-primary) 40%,white 60%);color:color-mix(in srgb,#ffffff 70%,var(--action-primary) 30%);cursor:not-allowed;box-shadow:none}
    .btn-secondary-demo{padding:10px 18px;border-radius:12px;border:1px solid var(--border-subtle);background:var(--surface-card);color:var(--text-strong);font-weight:600;font-family:var(--font-ui);cursor:pointer;transition:background .2s,box-shadow .2s}
    .btn-secondary-demo:hover{background:var(--surface-muted);box-shadow:0 8px 22px rgba(0,0,0,0.12)}
    .cards-grid{display:flex;flex-direction:column;gap:14px}
    .sample-card{padding:16px;border-radius:16px;border:1px solid var(--border-subtle);background:var(--surface-card);display:grid;gap:10px}
    .sample-card h4{margin:0;font-size:16px;font-family:var(--font-heading);color:var(--text-strong)}
    .sample-card p{margin:0;color:var(--text-muted);font-size:14px}
    .sample-card .meta{display:flex;justify-content:space-between;align-items:center;color:var(--text-muted);font-size:12px}
    .badge{padding:4px 8px;border-radius:999px;background:var(--badge-accent);color:var(--text-strong);font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.05em}
    .form{display:flex;flex-direction:column;gap:12px}
    .form-inline{gap:8px}
    .form-inline .inline-group{display:flex;gap:10px;align-items:center}
    .form-inline input{flex:1}
    .form label{font-size:12px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.05em}
    .form input{padding:10px 12px;border-radius:12px;border:1px solid var(--border-subtle);background:var(--surface-card);color:var(--text-strong);font-family:var(--font-body)}
    .form input:focus{outline:2px solid color-mix(in srgb,var(--action-primary) 35%,transparent);border-color:var(--action-primary)}
    .alias-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px}
    .alias-item{background:var(--surface-card);padding:18px;border-radius:16px;border:1px solid rgba(54,38,70,0.08);box-shadow:0 12px 30px rgba(54,38,70,0.08);display:flex;align-items:center;gap:14px}
    .alias-item .swatch{width:32px;height:32px;border-radius:10px;border:1px solid rgba(0,0,0,0.08)}
    .alias-item .info{flex:1}
    .alias-item .info strong{display:block;font-size:14px;font-family:var(--font-heading)}
    .alias-item .info span{font-size:12px;color:var(--text-muted)}
    .alias-item button{padding:8px 12px;border-radius:12px;border:1px solid var(--border-subtle);background:var(--surface-card);font-family:monospace;font-weight:600;cursor:pointer}
    .alias-item button:hover{background:var(--surface-muted)}
    .distribution-card{background:var(--surface-card);border-radius:20px;padding:24px;border:1px solid rgba(54,38,70,0.08);box-shadow:0 14px 38px rgba(54,38,70,0.1);display:flex;flex-direction:column;gap:16px}
    .distribution-card p{margin:0;color:var(--text-muted);font-size:13px}
    .ratio-bar{display:flex;height:46px;border-radius:16px;overflow:hidden;border:1px solid rgba(0,0,0,0.08);box-shadow:inset 0 -6px 18px rgba(0,0,0,0.05)}
    .ratio-bar span{display:flex;align-items:center;justify-content:center;font-weight:600;font-family:var(--font-ui);font-size:13px}
    .ratio-legend{display:flex;gap:14px;flex-wrap:wrap;font-size:12px;color:var(--text-muted)}
    .ratio-legend span{display:flex;align-items:center;gap:6px}
    .ratio-dot{width:10px;height:10px;border-radius:50%;border:1px solid rgba(0,0,0,0.12)}
    .typography-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:20px}
    .type-card{background:var(--surface-card);border-radius:16px;padding:20px;border:1px solid rgba(54,38,70,0.08);box-shadow:0 10px 26px rgba(54,38,70,0.08);display:flex;flex-direction:column;gap:12px}
    .type-card header{display:flex;justify-content:space-between;align-items:center}
    .type-card header h3{margin:0;font-size:16px;font-family:var(--font-heading)}
    .type-card code{font-family:monospace;font-size:12px;color:color-mix(in srgb,var(--color-secondary) 55%, var(--color-neutral) 45%)}
    .type-sample{font-size:28px;line-height:1.2}
    .type-meta{font-size:13px;color:var(--text-muted)}
    .copy-grid{display:flex;gap:8px;flex-wrap:wrap}
    .copy-grid button{font-family:monospace;font-weight:600;padding:8px 12px;border-radius:12px;border:1px solid var(--border-subtle);background:var(--surface-card);cursor:pointer}
    .copy-grid button:hover{background:var(--surface-muted)}
    footer{font-size:13px;color:var(--text-muted)}
    .notice{position:fixed;right:24px;bottom:24px;padding:12px 16px;border-radius:12px;background:var(--text-strong);color:#fff;font-size:13px;opacity:0;transform:translateY(12px);transition:all .3s}
    .notice.show{opacity:1;transform:translateY(0)}
    @media(max-width:960px){
      .component-row{grid-template-columns:1fr}
    }
    @media(max-width:720px){
      .wrapper{padding:36px 16px 56px}
      .hero{padding:26px}
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="container">
      <div class="brand">Palette Studio</div>
      <nav class="nav-links">
        <a class="nav-link active" href="index.html">Палитра</a>
        <a class="nav-link" href="lab.html">Лаборатория</a>
        <a class="nav-link" href="fonts.html">Шрифты</a>
      </nav>
    </div>
  </header>

  <main class="wrapper">
    <section class="hero">
      <div>
        <h1>Цветовая палитра</h1>
        <p>Демонстрационный стенд активного профиля: все компоненты используют CSS-переменные и выбранные шрифты. Обновляйте палитру и типографику в лаборатории — изменения появятся здесь мгновенно.</p>
        <p style="margin:8px 0 0;font-size:13px;color:var(--text-muted)">Текущий профиль: <strong id="activeProfileName">—</strong></p>
        <div class="cta">
          <a class="btn btn-primary" href="lab.html">Настроить цвета</a>
          <a class="btn btn-secondary" href="fonts.html">Выбрать шрифты</a>
        </div>
      </div>
      <div class="component-card" style="margin:0">
        <header>
          <h3>Hero-превью</h3>
          <span class="tag">Витрина</span>
        </header>
        <div style="border-radius:16px;padding:26px;background:linear-gradient(135deg,var(--surface-hero),var(--action-primary));color:#fff;display:flex;flex-direction:column;gap:12px;box-shadow:0 16px 42px rgba(0,0,0,0.18)">
          <span style="font-size:13px;letter-spacing:0.08em;text-transform:uppercase;opacity:0.75">Команда продукта</span>
          <div style="font-size:28px;font-weight:700;line-height:1.2;font-family:var(--font-heading)">Создавайте интерфейсы быстрее</div>
          <p style="margin:0;font-size:14px;opacity:0.85">Комбинируйте оттенки, проверяйте контраст и экспортируйте результат для проекта.</p>
          <a class="btn btn-primary" style="align-self:flex-start" href="#palette">Подробнее</a>
        </div>
      </div>
    </section>

    <section id="palette">
      <h2>Базовые токены</h2>
      <div class="palette-grid" id="tokenGrid"></div>
    </section>

    <section id="distribution">
      <h2>Правило 60/30/10</h2>
      <div class="distribution-card">
        <div class="ratio-bar">
          <span data-index-ratio="primary">60%</span>
          <span data-index-ratio="secondary">30%</span>
          <span data-index-ratio="accent">10%</span>
        </div>
        <div class="ratio-legend">
          <span><span class="ratio-dot" data-index-dot="primary"></span>Основные поверхности</span>
          <span><span class="ratio-dot" data-index-dot="secondary"></span>Вторичные блоки</span>
          <span><span class="ratio-dot" data-index-dot="accent"></span>Акценты и CTA</span>
        </div>
        <p>Используйте доминирующий цвет примерно на 60% площади (фон и большие секции), вторичный на 30% (карточки, подложки) и акцентный на 10% (кнопки, ссылки, бейджи).</p>
      </div>
    </section>

    <section>
      <h2>Компоненты интерфейса</h2>
      <div class="component-section">
        <div class="component-card">
          <header>
            <h3>Навигация</h3>
            <span class="tag">Layout</span>
          </header>
          <div class="nav-demo">
            <div style="font-weight:700;font-family:var(--font-heading)">Логотип</div>
            <div class="links">
              <span>Главная</span>
              <span>Продукт</span>
              <span>Контакты</span>
            </div>
          </div>
        </div>
        <div class="component-row">
          <div class="component-card">
            <header>
              <h3>Кнопки</h3>
              <span class="tag">CTA</span>
            </header>
            <ul class="button-list">
              <li class="button-item"><span>Основное состояние</span><button class="btn-demo">Primary</button></li>
              <li class="button-item"><span>Наведение</span><button class="btn-demo" data-state="hover">Hover</button></li>
              <li class="button-item"><span>Отключена</span><button class="btn-demo" data-state="disabled" disabled>Disabled</button></li>
              <li class="button-item"><span>Вторичная</span><button class="btn-secondary-demo">Secondary</button></li>
            </ul>
          </div>
          <div class="component-card">
            <header>
              <h3>Карточки</h3>
              <span class="tag">Content</span>
            </header>
            <div class="cards-grid">
              <div class="sample-card">
                <h4>Гайд по цветам</h4>
                <p>Пример карточки, использующей текущие переменные фона и текста.</p>
                <div class="meta"><span>3 часа назад</span><span class="badge">Новая</span></div>
              </div>
              <div class="sample-card">
                <h4>Релиз 2.0</h4>
                <p>Библиотека токенов, alias-переменные и профили.</p>
                <div class="meta"><span>Дизайн-команда</span><span class="badge">UI Kit</span></div>
              </div>
            </div>
          </div>
        </div>
        <div class="component-row">
          <div class="component-card">
            <header>
              <h3>Форма: заявка</h3>
              <span class="tag">Form</span>
            </header>
            <form class="form" onsubmit="return false">
              <label for="req-name">Имя</label>
              <input id="req-name" type="text" placeholder="Введите имя" />
              <label for="req-email">Email</label>
              <input id="req-email" type="email" placeholder="name@example.com" />
              <div style="display:flex;gap:10px;flex-wrap:wrap">
                <button class="btn-demo" type="submit">Отправить</button>
                <button class="btn-secondary-demo" type="button">Отмена</button>
              </div>
            </form>
          </div>
          <div class="component-card">
            <header>
              <h3>Форма: подписка</h3>
              <span class="tag">Form</span>
            </header>
            <form class="form form-inline" onsubmit="return false">
              <label for="subscribe-email">Email</label>
              <div class="inline-group">
                <input id="subscribe-email" type="email" placeholder="your@email.com" />
                <button class="btn-demo" type="submit">Подписаться</button>
              </div>
              <p style="margin:4px 0 0;font-size:12px;color:var(--text-muted)">Рассылаем только полезные материалы и новости.</p>
            </form>
          </div>
        </div>
      </div>
    </section>

    <section>
      <h2>Alias-переменные</h2>
      <div class="alias-grid" id="aliasGrid"></div>
    </section>

    <section id="typography">
      <h2>Шрифты профиля</h2>
      <div class="typography-grid">
        <div class="type-card">
          <header><h3>Заголовки</h3><code id="headingFontName"></code></header>
          <div class="type-sample" style="font-family:var(--font-heading)">H1 • Заголовок</div>
          <div class="type-meta">Используется для H1–H3 и ключевых акцентов.</div>
        </div>
        <div class="type-card">
          <header><h3>Основной текст</h3><code id="bodyFontName"></code></header>
          <div style="font-size:16px;line-height:1.7;font-family:var(--font-body)">
            <p style="margin:0">Гибкая основа для параграфов, подсказок и длинного контента.</p>
          </div>
          <div class="type-meta">Поддерживает кириллицу и удобочитаемость в интерфейсе.</div>
        </div>
        <div class="type-card">
          <header><h3>UI элементы</h3><code id="uiFontName"></code></header>
          <div class="type-sample" style="font-size:20px;font-family:var(--font-ui)">Кнопки и навигация</div>
          <div class="type-meta">Используется для кнопок, навигации и бейджей.</div>
        </div>
      </div>
    </section>

    <section>
      <h2>HEX-коды</h2>
      <p style="margin:0 0 12px;color:var(--text-muted)">Кликните по значению, чтобы скопировать.</p>
      <div class="copy-grid" id="hexGrid"></div>
    </section>

    <footer>
      Используйте стенд как итоговую витрину активного профиля. Настройки обновляются из лаборатории и страницы шрифтов.
    </footer>
  </main>

  <div class="notice" id="notice"></div>

  <script src="palette-store.js"></script>
  <script>
    const FONT_KEY = 'palette-studio-fonts';

    const {BASE_TOKENS, ALIAS_DEFS, loadState, resolveAliases, applyPalette, normalizeHex} = PaletteStore;

    const LEGACY_FONT_OPTIONS = [
      {id:'manrope', label:'Manrope', stack:"'Manrope', sans-serif", link:'https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&display=swap&subset=cyrillic'},
      {id:'inter', label:'Inter', stack:"'Inter', sans-serif", link:'https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap&subset=cyrillic'},
      {id:'rubik', label:'Rubik', stack:"'Rubik', sans-serif", link:'https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;600;700&display=swap&subset=cyrillic'},
      {id:'montserrat', label:'Montserrat', stack:"'Montserrat', sans-serif", link:'https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap&subset=cyrillic'},
      {id:'nunito', label:'Nunito', stack:"'Nunito', sans-serif", link:'https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap&subset=cyrillic'},
      {id:'raleway', label:'Raleway', stack:"'Raleway', sans-serif", link:'https://fonts.googleapis.com/css2?family=Raleway:wght@400;500;600;700&display=swap&subset=cyrillic'},
      {id:'pt-sans', label:'PT Sans', stack:"'PT Sans', sans-serif", link:'https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;700&display=swap&subset=cyrillic'},
      {id:'pt-serif', label:'PT Serif', stack:"'PT Serif', serif", link:'https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&display=swap&subset=cyrillic'},
      {id:'playfair', label:'Playfair Display', stack:"'Playfair Display', serif", link:'https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&display=swap&subset=cyrillic'},
      {id:'lora', label:'Lora', stack:"'Lora', serif", link:'https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&display=swap&subset=cyrillic'},
      {id:'fira-sans', label:'Fira Sans', stack:"'Fira Sans', sans-serif", link:'https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400;500;600;700&display=swap&subset=cyrillic'},
      {id:'noto-sans', label:'Noto Sans', stack:"'Noto Sans', sans-serif", link:'https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;600;700&display=swap&subset=cyrillic'},
      {id:'noto-serif', label:'Noto Serif', stack:"'Noto Serif', serif", link:'https://fonts.googleapis.com/css2?family=Noto+Serif:wght@400;600;700&display=swap&subset=cyrillic'},
      {id:'source-sans', label:'Source Sans 3', stack:"'Source Sans 3', sans-serif", link:'https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;600;700&display=swap&subset=cyrillic'},
      {id:'ibm-plex', label:'IBM Plex Sans', stack:"'IBM Plex Sans', sans-serif", link:'https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&display=swap&subset=cyrillic'},
      {id:'open-sans', label:'Open Sans', stack:"'Open Sans', sans-serif", link:'https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap&subset=cyrillic'},
      {id:'roboto', label:'Roboto', stack:"'Roboto', sans-serif", link:'https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap&subset=cyrillic'},
      {id:'ubuntu', label:'Ubuntu', stack:"'Ubuntu', sans-serif", link:'https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;500;700&display=swap&subset=cyrillic'},
      {id:'exo2', label:'Exo 2', stack:"'Exo 2', sans-serif", link:'https://fonts.googleapis.com/css2?family=Exo+2:wght@400;500;600;700&display=swap&subset=cyrillic'},
      {id:'spectral', label:'Spectral', stack:"'Spectral', serif", link:'https://fonts.googleapis.com/css2?family=Spectral:wght@400;500;600;700&display=swap&subset=cyrillic'}
    ];
    const LEGACY_FONT_MAP = Object.fromEntries(LEGACY_FONT_OPTIONS.map(font=>[font.id,{id:font.id,family:font.label,stack:font.stack,css:font.link}]));
    const DEFAULT_FONT_META = {
      heading:{...LEGACY_FONT_MAP.manrope},
      text:{...LEGACY_FONT_MAP.inter},
      ui:{...LEGACY_FONT_MAP.manrope}
    };

    const tokenGrid = document.getElementById('tokenGrid');
    const aliasGrid = document.getElementById('aliasGrid');
    const hexGrid = document.getElementById('hexGrid');
    const profileNameEl = document.getElementById('activeProfileName');
    const headingFontName = document.getElementById('headingFontName');
    const bodyFontName = document.getElementById('bodyFontName');
    const uiFontName = document.getElementById('uiFontName');
    const notice = document.getElementById('notice');
    const ratioSegments = document.querySelectorAll('[data-index-ratio]');
    const ratioDots = document.querySelectorAll('[data-index-dot]');

    const state = loadState();
    const activeProfile = state.profiles.find(p=>p.id===state.activeId) || state.profiles[0];
    applyPalette(activeProfile);
    const fonts = loadFonts();
    applyFonts(fonts);

    document.addEventListener('DOMContentLoaded', ()=>{
      profileNameEl.textContent = activeProfile.name;
      renderTokens();
      renderAliases();
      renderDistribution();
      renderHex();
      renderFontMeta(fonts);
    });

    function renderTokens(){
      tokenGrid.innerHTML='';
      BASE_TOKENS.forEach(token=>{
        const card=document.createElement('div');
        card.className='token-card';
        const swatch=document.createElement('div');
        swatch.className='swatch';
        swatch.style.background=`var(${token.variable})`;
        const meta=document.createElement('div');
        meta.className='meta';
        meta.innerHTML=`${token.label} <span class="var">${token.variable}</span>`;
        const hex=document.createElement('div');
        hex.className='hex';
        hex.textContent=getVar(token.variable);
        hex.addEventListener('click',()=>copy(hex.textContent));
        meta.appendChild(hex);
        const desc=document.createElement('div');
        desc.className='desc';
        desc.textContent=token.description;
        const usage=document.createElement('div');
        usage.className='usage';
        token.usage.forEach(item=>{
          const span=document.createElement('span');
          span.textContent=item;
          usage.appendChild(span);
        });
        card.append(swatch,meta,desc,usage);
        tokenGrid.appendChild(card);
      });
    }

    function renderAliases(){
      aliasGrid.innerHTML='';
      const resolved = resolveAliases(activeProfile);
      ALIAS_DEFS.forEach(def=>{
        const color = resolved[def.variable];
        const card=document.createElement('div');
        card.className='alias-item';
        const swatch=document.createElement('div');
        swatch.className='swatch';
        swatch.style.background=color;
        const info=document.createElement('div');
        info.className='info';
        info.innerHTML=`<strong>${def.label}</strong><span>${def.description}</span>`;
        const button=document.createElement('button');
        button.type='button';
        button.textContent=color;
        button.addEventListener('click',()=>copy(color));
        card.append(swatch,info,button);
        aliasGrid.appendChild(card);
      });
    }

    function renderDistribution(){
      if(!ratioSegments.length) return;
      const mapping = {
        primary: getVar('--ratio-primary') || getVar('--surface-primary'),
        secondary: getVar('--ratio-secondary') || getVar('--surface-muted'),
        accent: getVar('--ratio-accent') || getVar('--action-primary')
      };
      const flexMap = {primary:6, secondary:3, accent:1};
      ratioSegments.forEach(segment=>{
        const key = segment.dataset.indexRatio;
        const color = mapping[key] || getVar('--surface-card') || '#CCCCCC';
        const weight = flexMap[key] || 1;
        segment.style.flex = `${weight} ${weight} 0`;
        segment.style.background = color;
        segment.style.color = pickReadable(color);
        const percent = key==='primary' ? 60 : key==='secondary' ? 30 : 10;
        segment.textContent = `${percent}%`;
      });
      ratioDots.forEach(dot=>{
        const key = dot.dataset.indexDot;
        const color = mapping[key] || getVar('--surface-card') || '#CCCCCC';
        dot.style.background = color;
        dot.style.borderColor = pickReadable(color);
      });
    }

    function renderHex(){
      hexGrid.innerHTML='';
      BASE_TOKENS.forEach(token=>{
        const btn=document.createElement('button');
        btn.type='button';
        const value=getVar(token.variable);
        btn.textContent=value;
        btn.addEventListener('click',()=>copy(value));
        hexGrid.appendChild(btn);
      });
    }

    function renderFontMeta(fonts){
      headingFontName.textContent = fonts.heading?.family || DEFAULT_FONT_META.heading.family;
      bodyFontName.textContent = fonts.text?.family || DEFAULT_FONT_META.text.family;
      uiFontName.textContent = fonts.ui?.family || DEFAULT_FONT_META.ui.family;
    }

    function getVar(variable){
      return getComputedStyle(document.documentElement).getPropertyValue(variable).trim() || '#000000';
    }

    function copy(value){
      navigator.clipboard?.writeText(value).then(()=>showNotice(`Скопировано: ${value}`)).catch(()=>alert('Не удалось скопировать'));
    }

    function showNotice(text){
      notice.textContent=text;
      notice.classList.add('show');
      clearTimeout(showNotice.timer);
      showNotice.timer=setTimeout(()=>notice.classList.remove('show'),1400);
    }

    function pickReadable(hex){
      const luminance = relativeLuminance(parseHex(hex));
      return luminance > 0.6 ? '#1F1D2A' : '#FFFFFF';
    }

    function parseHex(hex){
      const match=normalizeHex(hex);
      const value=match || '#000000';
      const r=parseInt(value.slice(1,3),16);
      const g=parseInt(value.slice(3,5),16);
      const b=parseInt(value.slice(5,7),16);
      return {r,g,b};
    }

    function relativeLuminance({r,g,b}){
      const srgb=[r,g,b].map(v=>{
        const c=v/255;
        return c<=0.03928?c/12.92:Math.pow((c+0.055)/1.055,2.4);
      });
      return srgb[0]*0.2126 + srgb[1]*0.7152 + srgb[2]*0.0722;
    }

    function loadFonts(){
      try{
        const raw=localStorage.getItem(FONT_KEY);
        if(!raw) return cloneFontMeta(DEFAULT_FONT_META);
        const parsed=JSON.parse(raw);
        if(parsed && typeof parsed.heading === 'object' && parsed.heading !== null && parsed.heading.stack){
          return {
            heading: normalizeFontMeta(parsed.heading, DEFAULT_FONT_META.heading),
            text: normalizeFontMeta(parsed.text, DEFAULT_FONT_META.text),
            ui: normalizeFontMeta(parsed.ui, DEFAULT_FONT_META.ui)
          };
        }
        return {
          heading: legacyFontMeta(parsed?.heading, DEFAULT_FONT_META.heading),
          text: legacyFontMeta(parsed?.text, DEFAULT_FONT_META.text),
          ui: legacyFontMeta(parsed?.ui, DEFAULT_FONT_META.ui)
        };
      }catch(e){
        return cloneFontMeta(DEFAULT_FONT_META);
      }
    }

    function applyFonts(fonts){
      const root=document.documentElement;
      ['heading','text','ui'].forEach(key=>{
        const meta=fonts[key] || DEFAULT_FONT_META[key];
        if(meta?.css) ensureFontLoaded(meta);
        root.style.setProperty(key==='heading'?'--font-heading':key==='text'?'--font-body':'--font-ui', meta?.stack || DEFAULT_FONT_META[key].stack);
      });
    }

    function ensureFontLoaded(font){
      if(!font?.css) return;
      const id='font-'+(font.id || slugify(font.family || 'font'));
      if(document.getElementById(id)) return;
      const link=document.createElement('link');
      link.id=id;
      link.rel='stylesheet';
      link.href=font.css;
      document.head.appendChild(link);
    }

    function cloneFontMeta(source){
      return {
        heading: source.heading ? {...source.heading} : null,
        text: source.text ? {...source.text} : null,
        ui: source.ui ? {...source.ui} : null
      };
    }

    function normalizeFontMeta(entry, fallback){
      const base = fallback ? {...fallback} : {family:'Inter', stack:"'Inter', sans-serif", css:'', id:'inter'};
      if(entry && typeof entry === 'object'){
        if(entry.id) base.id = entry.id;
        if(entry.family) base.family = entry.family;
        if(entry.stack) base.stack = entry.stack;
        if(entry.css) base.css = entry.css;
      }
      return base;
    }

    function legacyFontMeta(id, fallback){
      if(id && LEGACY_FONT_MAP[id]){
        return {...LEGACY_FONT_MAP[id]};
      }
      return {...fallback};
    }

    function slugify(value){
      return String(value).toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
    }

  </script>
</body>
</html>
